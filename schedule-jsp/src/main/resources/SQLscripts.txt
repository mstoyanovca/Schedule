create database schedule;
use schedule;


create table user (
    user_id       int(32) auto_increment,
    version       int(32),
    email         varchar(64) not null,
    password      varchar(128) not null,
    enabled       tinyint(1) not null default 0,
    primary key   (user_id),
    unique        (email));


create table token (
    token_id      int(32) auto_increment,
    version       int(32),
    token         varchar(64) not null,
    expiry_date   timestamp not null,
    user_id       int(32) not null,
    primary key   (token_id),
    foreign key   (user_id) references user(user_id),
    unique        (token, user_id));


create table role (
    role_id       int(32) auto_increment,
    version       int(32),
    role          varchar(20) not null,
    user_id       int(32) not null,
    primary key   (role_id),
    foreign key   (user_id) references user(user_id));


create table persistent_logins (
	username 	varchar(64) not null,
    series 		varchar(64) not null,
    token 		varchar(64) not null,
    last_used   timestamp not null,
    primary key (series));


create table teacher (
    teacher_id       int(32) auto_increment,
    version          int(32),
    name		     varchar(50) not null,
    user_id          int(32) not null,
    primary key      (teacher_id),
    foreign key      (user_id) references user(user_id));


create table student (
    student_id       int(32) auto_increment,
    version          int(32),
    name		     varchar(50) not null,
    note             varchar(256),
    teacher_id       int(32) not null,
    primary key      (student_id),
    foreign key      (teacher_id) references teacher(teacher_id));


create table phone (
    phone_id       int(32) auto_increment,
    version        int(32),
    number         varchar(30) not null,
    type           varchar(5) not null,
    student_id     int(32) not null,
    primary key    (phone_id),
    foreign key    (student_id) references student(student_id));


create table lesson (
    lesson_id        int(32) auto_increment,
    version          int(32),
	start_time       timestamp not null,
	end_time         timestamp not null,
	dow              enum('SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY') not null,
	note             varchar(256),
	teacher_id       int(32) not null,
	student_id       int(32) not null,
	primary key      (lesson_id),
	foreign key      (teacher_id) references teacher(teacher_id),
	foreign key      (student_id) references student(student_id));





